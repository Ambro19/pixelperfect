services:
  - type: web
    name: pixelperfect-screenshot-api
    env: python
    plan: free

    buildCommand: |
      apt-get update -qq
      apt-get install -y --no-install-recommends ffmpeg
      pip install --upgrade pip
      pip install --no-cache-dir -r requirements.txt

    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT

    healthCheckPath: /health

    envVars:
      - key: ENVIRONMENT
        value: production

      - key: DEBUG
        value: false

      - key: HOST
        value: 0.0.0.0

      - key: PORT
        value: 10000

      - key: FRONTEND_URL
        value: https://pixelperfectapi.net

      - key: BACKEND_URL
        value: https://api.pixelperfectapi.net

      - key: CORS_ORIGINS
        value: https://pixelperfectapi.net,https://www.pixelperfectapi.net

      - key: SECRET_KEY
        sync: false

      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: STRIPE_PRO_LOOKUP_KEY
        value: pixelperfect_pro_monthly
      - key: STRIPE_BUSINESS_LOOKUP_KEY
        value: pixelperfect_business_monthly

      - key: R2_ENDPOINT_URL
        value: https://<your_account_id>.r2.cloudflarestorage.com
      - key: R2_ACCESS_KEY_ID
        sync: false
      - key: R2_SECRET_ACCESS_KEY
        sync: false
      - key: R2_BUCKET_NAME
        value: pixelperfect-screenshots

      - key: CONTACT_FROM
        value: no-reply@onetechly.com
      - key: CONTACT_RECIPIENT
        value: onetechly@gmail.com
